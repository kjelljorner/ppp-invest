---
author: 
  - name: "Kjell Jorner"
    orcid: 0000-0002-4191-6790
    email: "kjell.jorner@chem.ethz.ch"
    corresponding: true
    affiliations: 
      - ref: eth
      - ref: chalmers
      - ref: toronto-chem
      - ref: toronto-cs
  - name: "Robert Pollice"
    orcid: 0000-0001-8836-6266
    affiliations: 
      - ref: rug
      - ref: toronto-chem
      - ref: toronto-cs  
  - name: "Cyrille Lavigne"
    orcid: 0000-0003-2778-1866
    affiliations: 
      - ref: toronto-chem
      - ref: toronto-cs    
  - name: "Alán Aspuru Guzik"
    orcid: 0000-0002-8277-4434
    affiliations:
      - ref: toronto-chem
      - ref: toronto-cs
      - ref: toronto-chem-eng
      - ref: toronto-mat-eng
      - ref: vector
      - ref: ac

affiliations:
  - id: eth
    name: "ETH Zürich"
    department: "Institute of Chemical and Bioengineering, Department of Chemistry and Applied Biosciences"
    address: "Vladimir-Prelog-Weg 1"
    postal-code: "CH-8093"
    city: "Zürich"
    country: "Switzerland"
  - id: chalmers
    name: "Chalmers University of Technology"
    department: "Department of Chemistry and Chemical Engineering"
    address: "Kemigården 4"
    postal-code: "SE-41258"
    city: "Gothenburg"
    country: "Sweden"
  - id: toronto-chem
    name: "University of Toronto"
    department: "Chemical Physics Theory Group, Department of Chemistry"
    address: "80 St. George St."
    postal-code: "M5S 3H6"
    city: "Toronto"
    state: "Ontario"
    country: "Canada"
  - id: toronto-cs
    name: "University of Toronto"
    department: "Department of Computer Science"
    address: "40 St. George St."
    postal-code: "M5S 2E4"
    city: "Toronto"
    state: "Ontario"
    country: "Canada"
  - id: rug
    name: "University of Groningen"
    department: "Stratingh Institute for Chemistry"
    address: "Nijenborgh 4"
    postal-code: "9747 AG"
    city: "Groningen"
    country: "The Netherlands"
  - id: toronto-chem-eng
    name: "University of Toronto"
    department: "Department of Chemical Engineering & Applied Chemistry"
    address: "200 College St."
    postal-code: "M5S 3E5"
    city: "Toronto"
    state: "Ontario"
    country: "Canada"
  - id: toronto-mat-eng
    name: "University of Toronto"
    department: "Department of Materials Science & Engineering"
    address: "184 College St."
    postal-code: "M5S 3E4"
    city: "Toronto"
    state: "Ontario"
    country: "Canada"    
  - id: vector
    name: "Vector Institute for Artificial Intelligence"
    address: "661 University Ave. Suite 710"
    postal-code: "M5G 1M1"
    city: "Toronto"
    state: "Ontario"
    country: "Canada" 
  - id: cifar
    name: "Lebovic Fellow"
    department: "Canadian Institute for Advanced Research (CIFAR)"
    postal-code: "M5G 1M1"
    city: "Toronto"
    state: "Ontario"
    country: "Canada" 
  - id: ac
    name: "Acceleration Consortium"
    department: "University of Toronto"
    city: "Toronto"
    state: "Ontario"
    country: "Canada"

title: "Ultrafast computational screening of molecules with inverted singlet-triplet energy gaps using semi-empirical quantum chemistry"
abstract: |
  Molecules with an inverted energy gap between their first excited states of singlet and triplet multiplicity have promising applications in the next generation of organic light-emitting diode (OLED) materials. Unfortunately, such molecules are rare and only a handful of examples are currently known. High-throughput virtual screening could assist in finding novel classes of molecules, but current efforts are hampered by the high computational cost of the required quantum-chemical methods. We present a method based on the semi-empirical Pariser-Parr-Pople theory augmented by perturbation theory and show that it reproduces inverted gaps at a fraction of the cost of the current employed methods. Our study opens the doors for ultra-high-throughput virtual screening and inverse design to accelerate the discovery and development of the new generation of OLED materials.
bibliography: [references.bib] 
link-citations: true
date: last-modified
format:
  elsevier-pdf:
    cite-method: citeproc
    journal:
      name: "Journal of Physical Chemistry A"
      model: "3p"    
    number-sections: false
    keep-tex: false            
    include-in-header:
        - file: macros.tex    
csl: "acs.csl"
---

<!-- Definition of parameters for tables -->
```{python}
# | tags: [parameters]
# | echo: false

tab_local_azaphenalenes = ""
tab_local_azulenes = ""
tab_global_all_gaps = ""
tab_global_scaffolds = ""
tab_garner_gaps = ""
```

# Introduction

Organic light-emitting diodes (OLEDs) is a technology for generating light from electricity using organic molecules.[@yangRecentAdvancesOrganic2017] The first generation of OLEDs were limited to an efficiency of max 25% due to spin statistics. As the transition T~1~ $\rightarrow$ S~0~, from the lowest excited triplet state to the singlet ground state, is quantum-mechanically forbidden, the OLED molecule can formally only emit from its first excited state of singlet multiplicity, S~1~. The second generation of OLEDs exploited ways of increasing the rate of this spin-forbidden phosphorescence. The third generation of OLEDs are based on Thermally Activated Delayed Fluorescence (TADF), where the S~1~ state is partially populated from a near-lying T~1~ state. For this to happen, the gap $\DeltaE{ST}$ between the states needs to sufficiently small so that the thermal activation competes with non-radiative decay processes from T~1~. However, as the T~1~ population is still substantial, problems with stability and lower than ideal intensity due to non-radiative decay persist. The logical step for the next generation of OLEDs is to emit directly from an S~1~ state that lies below the T~1~ state, potentially converting all of the electrically generated excitons into photons, _i.e._, 100% efficiency. 

Molecules that fulfill this criterion have been branded with the acronym INVErted Singlet Triplet energy gap (INVEST) and are exceedingly rare.[@liOrganicMoleculesInverted2022] They are said to violate Hund's rule of maximum multiplicity, which describes that the electronic state with the highest spin (in this case the triplet) should be lowest in energy. While examples of molecules violating Hund's rule in the excited state have been known since the 1970s and 1980s,[@kollmarViolationHundRule1978; @leupinLowlyingElectronicallyExcited1980; @kosekiViolationHundMultiplicity1985] it is only recently that they have received considerable attention for application in OLEDs.[@desilvaInvertedSingletTriplet2019;@polliceOrganicMoleculesInverted2021;@aizawaDelayedFluorescenceInverted2022] As they are rare, recent efforts have used high-throughput virtual screening (HTVS) with computational chemistry to identify new compounds with inverted gaps, focusing on expanding the local chemical space around specific scaffolds[@polliceOrganicMoleculesInverted2021;@aizawaDelayedFluorescenceInverted2022] or scanning larger (combinatorially or experimentally derived) datasets to identify novel scaffolds.[@terenceblaskovitsSymmetryInducedSinglet2023;@omarIdentificationUnknownInverted2023;@garnerDoublebondDelocalizationNonalternant2023] These HTVS efforts have been successful at identifying several new INVEST candidates, some of which have also been synthesized and tested experimentally.[@aizawaDelayedFluorescenceInverted2022] 

While this early success of HTVS is highly encouraging, it is hampered by the cost of the computational methods. Excitation energies are routinely calculated by time-dependent density functional theory (TD-DFT), which has become a workhorse of computational photophysics over the last decades.[@casidaProgressTimeDependentDensityFunctional2012] Unfortunately, it has been shown that TD-DFT fails to capture the inverted gap of INVEST compounds, as the method only considers single electronic excitations.[@desilvaInvertedSingletTriplet2019] Inclusion of at least double excitations are necessary to reproduce the inverted gaps, corresponding to methods such as double hybrid TD-DFT or excited state coupled-cluster methods such as second-order approximate coupled cluster singles and doubles (CC2) or equation of motion coupled cluster with single and double excitations (EOM-CCSD). In line with the results of benchmarking studies,[@ricciSingletTripletExcited2021;@sancho-garciaViolationHundRule2022] recent HTVS studies have used methods such as the complete active space self-consistent field (CASSCF) and CC2 for preliminary screening, while confirming inverted gaps with more expensive methods such as multistate complete active space second-order perturbation theory (MS-CASPT2) and EOM-CCSD. These methods are not only expensive, but in the case of the CAS methods, also require the choice of an orbital active space, something which is not routinely automatized.

Motivated by the need for faster methods for HTVS of INVEST compounds, we wondered if it would be possible to perform much simpler calculations as a pre-screening step for the more expensive methods. Based on prior work in the literature from the 1970s and 1980s, we find that the inverted gaps can be recovered already with the semi-empirical Pariser-Parr-Pople method using configuration interaction singles (CIS) and adding key double excitations. The PPP method considers only the $\pi$ electrons in a minimal valence basis and approximates all integrals from experimental data and a few empirical parameters, making it computationally extremely cheap. At the same time, it retains the conceptual clarity of Hückel theory and allows for straightforward interpretation of the inverted gap in terms of the well-known concept of dynamic spin polarization (DSP). We show that the method is capable of finding hits both in the local chemical space around known scaffolds, and of identifying hits in more diverse datasets. While there are clear limitations to the method, we believe that it will open the doors for ultra high-throughput virtual screening (UHTVS) of compound libraries orders of magnitude larger than today. The method is also perfectly applicable as a scoring function in inverse design algorithms.

# Theory

While the recent literature has focused on applying high-level *ab initio* and DFT methods to study INVEST compounds, we believe that some conceptual clarity has been lost in process. Instead, we apply the simplest possible electronic structure method that can capture the physics of the problem. The Pariser-Parr-Pople (PPP) method is an extension of the semi-empirical Hückel molecular orbital theory for $\pi$-electron systems that includes electron correlation.[@pariserSemiEmpiricalTheory1953a;@pariserSemiEmpiricalTheory1953; @popleElectronInteractionUnsaturated1953] It originated in the 1950s, with new parametrizations being developed mainly in the 1960s and 1970s, and was used in the dye industry at least until the 1980s before the advent of more accurate ab initio methods.[@griffithsPracticalAspectsColour1982] The PPP method retains the conceptual clarity of Hückel theory, while at the same time including the electron correlation that is necessary to capture the inverted gap. 

## Pariser-Parr-Pople theory

Within Pople's formulation of PPP theory, Roothan's equations are solved self-consistently.[@popleElectronInteractionUnsaturated1953]. Under the Zero Differential Overlap (ZDO) approximation,<!-- REF: pariser, parr, pople, maybe Dral paper --> overlap integrals are neglected for orbitals on different centers, leading to a simplification of the Roothan equations as $\mathbf{S}$ becomes the unit matrix $\mathbf{I}$ 

$$
\mathbf{FC} = \mathbf{SCE} = \mathbf{ICE} = \mathbf{CE}
$$ {#eq-roothan}

where $\mathbf{F}$ is the Fock matrix, $\mathbf{C}$ contains the molecular orbital coefficients and $\mathbf{E}$ is the diagonal matrix of the orbital energy eigenvalues. Given $\mathbf{F}$, the corresponding $\mathbf{C}$ and $\mathbf{E}$ can then be determined either self-consistently (following Pople[@popleElectronInteractionUnsaturated1953]) or via configuration interaction (following Pariser and Parr[@pariserSemiEmpiricalTheory1953a; @pariserSemiEmpiricalTheory1953]), most often starting from a guess $\mathbf{C}$ from the corresponding Hückel model. The main effort is then to construct $\mathbf{F}$, which has the following matrix elements[@beveridgeParametrizationSemiempiricalPi1971]
$$
F_{rr} = H_{rr} + \sum_{t} P_{tt} \gamma_{rt} - \frac{1}{2} P_{rr} \gamma_{rr} 
$$ {#eq-f-rr}

$$
F_{rs} = H_{rs} - \frac{1}{2} P_{rs} \gamma_{rs}
$$ {#eq-f-rs}

where $P_{rs}$ are elements of the density matrix $\mathbf{P}$ and $\gamma_{rr}$ and $\gamma_{rs}$ are parameters called the *one-center and two-center electron repulsion integrals*, respectively. The *core resonance integral* matrix elements of $\mathbf{H}$ are given by
$$
H_{rr} = \alpha_r = U_r - \sum_{s \neq r} Z_s \gamma_{rs}
$$ {#eq-h-rr}
$$
H_{rs} = \beta_{rs}
$$ {#eq-h-rs}

where $\alpha_{r}$ is the *one-center core resonance integral*, $U_r$ is a parameter of model called the *atomic valence state potential*, $Z_s$ is the effective nuclear charge and $\beta_{rs}$ is the *two-center resonance integral*, another parameter of the model.

## Parametrization

The four parameters are thus $U_{r}$, $\gamma_{rr}$, $\gamma_{rs}$ and $\beta_{rs}$. They are derived either from experiment, first principles, or a combination of both. The Pariser-Parr approximation leads to
$$
U_{r} = - \mathrm{IP}_v
$$ {#eq-u-r}

where $\mathrm{IP}_v$ is the *valence-state ionization potential* of the orbital and atom in questions (*e.g.* a 2*p* orbital of an *sp*^2^-hybridized C atom).[@mullikenNewElectroaffinityScale1934] The $\mathrm{IP}_v$ values (and the corresponding electron affinities $\mathrm{EA}_v$) are tabulated by Hinze and Jaffé as determined from experimental data.[@hinzeElectronegativity1962; @hinzeElectronegativityOrbitalElectronegativity1962] $\gamma_{rr}$ also enjoys an almost universally adopted approximation due to Pariser and Parr:
$$
\gamma_{rr} = \mathrm{IP}_v - \mathrm{EA}_v
$$ {#eq-gamma-rr}

For $\gamma_{rs}$ and $\beta_{rs}$, there is much less consensus. Formulas for $\gamma_{rs}$ have been suggested by, among others, Mataga and Nishimoto[@matagaElectronicStructureSpectra1957] and Ohno[@ohnoRemarksPariserParrPopleMethod1964], but here we follow the approach by Beveridge and Hinze[@beveridgeParametrizationSemiempiricalPi1971]:
$$
\gamma_{rs} = \frac{1}{a_{rs} \exp{\left( -r_{rs}^2/2a_{rs}^2\right)} + r_{rs}}
$$ {#eq-gamma-rs}

where $r_{rs}$ is the distance between the two atoms $r$ and $s$, and
$$
a_{rs} = \frac{2}{\gamma_{rr} + \gamma_{ss}}
$$ {#eq-a}

For $\beta_{rs}$, expressions have been given by, *e.g.*, Linderberg[@linderbergConsistencyRequirementPariserParrPople1967] and Jug[@jugOperatorEquationsApproximate1972], based on first principles and by Dewar[@chungGroundStatesConjugated1965] based on experimental data. Here we again follow Beveridge and Hinze,[@beveridgeParametrizationSemiempiricalPi1971] who derived, following Ohno[@ohnoRemarksPariserParrPopleMethod1964]:

$$
\beta_{rs} = \frac{1}{2} \left( Z_r + Z_s \right) S_{rs} \left( \gamma_{rs} - \frac{2C}{r_{rs}} \right)
$$ {#eq-beta-rs}

where $C = 0.545$ is a parameter that was fit in the original publication to reproduce experimental excitation energies.[@beveridgeParametrizationSemiempiricalPi1971] The overlap integral $S_{rs}$ is determined from the overlap of Slater *p* orbitals with exponents

$$
\zeta_r = \frac{1280}{501} \gamma_{rr}
$$

according to recursion formulas given by Mulliken.[@mullikenFormulasNumericalTables1949] Thus, the four parameters $U_{r}$, $\gamma_{rr}$, $\gamma_{rs}$ and $\beta_{rs}$ are expressed completely in terms of the corresponding valence state ionization potentials $\mathrm{IP}_v$ and electron affinities $\mathrm{EA}_v$ as well as the completely empirical parameter $C$.

The distance dependence of $\beta_{rs}$ and $\gamma_{rs}$ allows for treatment of bond-length alternation beyond idealized geometries. In addition, we have followed the literature[@murrellSemiempiricalSelfconsistentfieldMolecular1972] and added an angle-dependence to $\beta_{rs}$ according to

$$
\beta_{rs}^\prime = \beta_{rs} \cos{\theta}
$$

where $\theta$ is the twist angle between the two *p* orbitals. We have determined $\theta$ as the average of all possible dihedrals involving the two atoms $r$ and $s$.

## Excited state calculations

The energy difference of the vertically excited S~1~ and T~1~ states can be determined by Roothan's expression at the SCF level[@roothaanNewDevelopmentsMolecular1951]
$$
\DeltaEST{SCF} = \E{S} - \E{T} = 2 \left( xy \vert yx \right) = 2 \left( x \lvert K_y \rvert x \right) = 2K 
$$ {#eq-exchange}

where $K$ is the exchange integral between the two orbitals involved in the single excitation (normally the HOMO and the LUMO). As defined here, a positive $\DeltaE{ST}$ corresponds to the usual situation with the triplet being lower in energy than the singlet, while a positive $\DeltaE{ST}$ corresponds to an inverted gap. The exchange integral depends strongly on the spatial overlap between the the two orbitals, which in the ZDO approximation can be computed as:[@peachExcitationEnergiesDensity2008]

$$
O_{xy} = \sum_{r} |c_{r,x}||c_{r,y}|
$$

where $|c_{r,i}|$ is the absolute value of the coefficient of orbital $i$ on center $r$. When the overlap is zero, the exchange interaction vanishes and $\DeltaEST{SCF}$ is zero. Unfortunately, so is the oscillator strength, $f$, between the two states,[@klessingerExcitedStatesPhotochemistry1995] which is non-optimal for OLED materials that should emit light. Consequently, there is a trade-off between having a small HOMO-LUMO overlap to reduce the exchange interaction, while still maintaining a sufficient oscillator strength.

A more precise expression for $\DeltaE{ST}$ can be obtained by configuration interaction singles (CIS).[@beveridgeParametrizationSemiempiricalPi1971] While CIS adds some correlation for the excited states, it is necessary to add additional excitations beyonds singles to capture the inverted $\DeltaE{ST}$. Fortunately, the most important excitations have already been identified in the literature long ago. Singlet-triplet inversion occurs also for the ground state, where several violations of Hund’s rule are well known, for example for bond-equalized cyclobutadiene at the *D*~4h~ geometry and pentalene at the *D*~2h~ geometry. Borden and Davidson explained this effect in terms of dynamic spin polarization (DSP),[@bordenTheoreticalStudiesDiradicals1981] in which the electrons of a pair of disjoint non-bonding molecular orbitals (NBMOs, [@fig-dsp]a) experience stronger electron correlation effects in the singlet state as compared to the triplet state ([@fig-dsp]b). For a pedagogic introduction to the topic, the reader is referred to an excellent article by Karafiloglou[@karafiloglouDoubleDynamicSpin1989] As outlined by Kollmar and Staemmler,[@kollmarViolationHundRule1978] as well as Malrieu and co-workers,[@benamorSpinPolarizationElectronic2020] an alternative view of the same phenomenon is through admixture of singly-excited configurations into the electronic wavefunction of the ground state ([@fig-dsp]c). The DSP effect for the S~1~ excited state can correspondingly be described by admixture of doubly excited configurations,[@kollmarViolationHundRule1978] as they are singly excited with respect to the S~1~ state, and doubly excited with respect to the S~0~ ground state ([@fig-dsp]d). 

As first shown by Kollmar and Staemmler,[@kollmarViolationHundRule1978] and recently re-emphasized by Pernal and co-workers,[@drwalRoleSpinPolarization2023] the $\DeltaE{ST}$ can be approximated by a combination of two terms, the first one being the exchange interaction $2K$ (given by @eq-exchange) and a correction term $\DeltaE[DSP]{}$ due to the DSP, which can be approximated with perturbation theory:[@kollmarViolationHundRule1978]

![Dynamic spin polarization stabilizes the open-shell singlet state over the open-shell triplet. (a) Transformation of the canonical frontier molecular orbitals creates a set of disjoint non-bonding molecular orbitals for cyclobutadiene. Singlet and triplet occupations are shown. (b) Dynamic spin polarization preferentially stabilizes the singlet state of cyclobutadiene through additive spin polarization for the singlet and competitive spin polarization for the triplet. (c) An alternative description of the spin polarization phenomenon is via configuration interaction and admixture of excited configurations into the ground state. (d) In the same way as cyclobutadiene is stabilized by DSP in the singlet ground state, molecules with inverted singlet-triplet gaps in the excited state are also stabilized by DSP that can be described by admixture of excited configurations. For singly excited states, this means addition of doubly excited states.](../data/figures/dynamic_spin_polarization.pdf){#fig-dsp}

$$
\DeltaE[DSP]{SCF} =  - \sum_{i}\sum_{k}
    \frac{1}{2} \left( 
    \frac{3 \Integral{-}}{\EState[1]{S} - \EState{S}}
    - \frac{\Integral{-}}{\EState[1]{T} - \EState{T}}
    - \frac{2 \Integral{+}}{\EState[2]{T} - \EState{T}}
    \right)
$$

Here, $K_x$ and $K_y$ are exchange operators, $E(\phi_{\mathrm{S}})$ and $E(\phi_{\mathrm{T}})$ are the energies of the singlet and triplet excited determinants, while $E (\phi_{\mathrm{S}}^{1})$, $E (\phi_{\mathrm{T}}^{1})$ and  $E(\phi_{\mathrm{T}}^{2})$ are the energies of doubly excited determinants. They can be written in terms of the correspond orbital energies, $\epsilon_i$, provided the same orbitals are used for both the singlet and triplet states.[@benamorSpinPolarizationElectronic2020]

$$
\DeltaE[DSP]{SCF} =  - \sum_{i}\sum_{k}
    \frac{1}{2} \left( 
    \frac{3 \Integral{-}}{\epsilon_k - \epsilon_i}
    - \frac{\Integral{-}}{\epsilon_k - \epsilon_i}
    - \frac{2 \Integral{+}}{\epsilon_k - \epsilon_i}
    \right)
$$

The simplest approximation for $\DeltaE{ST}$ taking DSP into account is then

$$
\DeltaEST[DSP]{SCF} = 2K + \DeltaE[DSP]{SCF}
$$

Alternatively, $\DeltaE[DSP]{}$ can be calculated with respect to the CIS states,[@head-gordonDoublesCorrectionElectronic1994]

$$
\begin{split}
\DeltaE[DSP]{CIS} =  - \sum_{i}\sum_{k}
    \frac{1}{2} \left( 
    \frac{3 \Integral{-}}{\epsilon_k + \epsilon_y - \epsilon_y - \epsilon_i - \DeltaE{S,CIS}}
    - \frac{\Integral{-}}{\epsilon_k + \epsilon_y - \epsilon_y - \epsilon_i - \DeltaE{T,CIS}} \right. \\
    \left. - \frac{2 \Integral{+}}{\epsilon_k + \epsilon_y - \epsilon_y - \epsilon_i - \DeltaE{T,CIS}}
    \right)
\end{split}
$$

and added as a correction to the energy gap at the CIS level to yield a possibly more accurate value

$$
\DeltaEST[DSP]{CIS} = \DeltaEST{CIS} + \DeltaE[DSP]{CIS}
$$

# Methods

The PPP method was implemented in the Python package [coulson]{.smallcaps}[@jornerCoulson] which is freely available on GitHub with a permissive MIT license. Further details on [coulson]{.smallcaps} will be reported elsewhere. The PPP wavefunction was converged with the self-consistent field method using the naive variational principle. To speed up the calculations, we derived a spline interpolation of the overlap integrals,[@mullikenFormulasNumericalTables1949] which will be reported separately. All calculations have been performed on a MacBook Air laptop computer with an M2 processor. We further integrated [coulson]{.smallcaps} with [PySCF]{.smallcaps}[@sunRecentDevelopmentsPySCF2020] to provide alternative algorithms for the SCF convergence and CIS and found the results consistent within numerical accuracy. Oscillator strengths were calculated with the dipole length approximation.[@jorgensenTimedependentHartreeFockCalculations1970;@klessingerExcitedStatesPhotochemistry1995;@damourGroundExcitedStateDipole2023] Some compounds exhibit negative triplet excitation energies and in some case even negative singlet excitation energies, which indicates a restricted-unrestricted instability of the ground state wavefunction. We have here taken the pragmatic approach to ignore these issues, while we will highlight below some examples where it occurs and if it has any effect on the overall results. This approach can be partly justified as the reference data also does not include any stability analysis. The results should anyway be indicative of the gap between the lowest singlet and triplet states with open-shell character, regardless of if they are lower in energy than the closed-shell singlet.

We used four separate datasets for this study. The first is a set of azaphenalenes previously studied by some of us, comprising 257 substituted compounds, for which excitation energies were computed with (2nd-order) algebraic-diagrammatic construction, {{< var reference_level >}}/[Robert: Fill out], and geometries were optimized with B3LYP/[Robert: Fill out][@polliceOrganicMoleculesInverted2021] The second is a set substituted 138 aza-azulenes with {{< var reference_level >}}/[Robert: Fill out] excitation energies and optimized with the B97-3c composite method.[Robert: Add ref to dataset if it exists.] The third is a set of 16 rationally designed scaffolds, which including substitutions amounts to {{< var global_n_total >}} unique compounds, optimized at the B97-3c level and with excitation energies at the {{< var reference_level >}}/[Robert: Fill out] level.[Robert: Add ref to dataset if it exists.] The fourth is a set 315 non-alternant hydrocarbons including substitutions, divided into three subsets of size 76, 187 and 52, optimized at the ωB97X-D/def2-TZVP level and with excitation energies at the CC2/aug-cc-pVTZ level. 

# Results and discussion

## Qualitative understanding of the inverted gap

We first demonstrate that our method is capable of capturing the inverted $\DeltaE{ST}$ for some model compounds. As shown by Toyota and co-workers, pentalene at the ideal  $D_\mathrm{2h}$ geometry has an inverted gap, while relaxation to the minimum with $C_\mathrm{2h}$ symmetry leads to a normal gap.[@kosekiViolationHundMultiplicity1985] In our calculations, pentalene with equal bond lengths of 1.4 Å displays a small HOMO-LUMO overlap of {{< var pentalene_ideal_overlap >}}, leading to a small exchange interaction of only $2K=$ {{< var pentalene_ideal_2_exchange >}} kcal/mol (@fig-pentalene-ideal-orbitals). The dynamic spin polarization correction $\DeltaE[DSP]{SCF}$ of {{< var pentalene_ideal_dsp_scf >}} kcal/mol leads to a net predicted $\DeltaEST[DSP]{SCF}$ of {{< var pentalene_ideal_t1_s1_dsp_scf >}} kcal/mol. Adding additional correlation with CIS leads to a $\DeltaEST[DSP]{CIS}$ of {{< var pentalene_ideal_t1_s1_dsp_cis >}} kcal/mol. The reference value calculated with {{< var reference_level >}} is {{< var azaphenalene_t1_s1_ref >}} kcal/mol. The simple perturbation theory model allows us to gain additional insight into the contributions to $\DeltaE[DSP]{SCF}$ as they correspond to single excitations between doubly occupied orbitals below the HOMO and unoccupied orbitals above the LUMO (@fig-pentalene-ideal-excitations). Three excitations, HOMO-3 → LUMO+2, HOMO-2 → LUMO+1 and HOMO-1 → LUMO+3 are identified as the main contributors to the spin polarization effect, and could potentially be tuned by substituent effects.

![Orbitals energies and frontier orbitals of pentalene at the idealized $D_\mathrm{2h}$ geometry and bond lengths of 1.4 Å.]({{< var fig_pentalene_ideal_orbitals >}}.png){#fig-pentalene-ideal-orbitals}

![Excitations and their contribution to $\DeltaE[DSP]{SCF}=$ {{< var pentalene_ideal_dsp_scf >}} kcal/mol for pentalene at the $D_\mathrm{2h}$ geometry and bond lengths of 1.4 Å.]({{< var fig_pentalene_ideal_excitations >}}.png){#fig-pentalene-ideal-excitations}

Using the relaxed $C_\mathrm{2h}$ geometry leads to dramatic changes in the frontier orbitals, with an increased HOMO-LUMO overlap of {{< var pentalene_overlap >}} and a sizeable exchange interaction of {{< var pentalene_2_exchange >}} kcal/mol (@fig-pentalene-orbitals). Consequently, the calculated gap is now normal at $\DeltaEST[DSP]{SCF}=$ {{< var pentalene_t1_s1_dsp_scf >}} kcal/mol, aggravated by a diminished $\DeltaE[DSP]{SCF}$ of only {{< var pentalene_dsp_scf >}} kcal/mol. A similar result is obtained with CIS: $\DeltaEST[DSP]{CIS}=$ {{< var pentalene_t1_s1_dsp_cis >}} kcal/mol. The reference value calculated with {{< var reference_level >}} is {{< var pentalene_t1_s1_ref >}} kcal/mol. The excitations contributing to $\DeltaE[DSP]{SCF}$ at the $D_\mathrm{2h}$ geometry have been significantly diminished, only partially alleviated by the addition of a minor stabilization from HOMO-2 → LUMO+3 (@fig-pentalene-excitations).

![Orbitals energies and frontier orbitals of pentalene at the optimized $C_\mathrm{2h}$ geometry.]({{< var fig_pentalene_orbitals >}}.png){#fig-pentalene-orbitals}

![Excitations and their contribution to $\DeltaE[DSP]{SCF}=$ {{< var pentalene_dsp_scf >}} kcal/mol for pentalene at the optimized $C_\mathrm{2h}$ geometry.]({{< var fig_pentalene_excitations >}}.png){#fig-pentalene-excitations}

Azaphenalene is the prototypical molecule that started the renewed investigations into INVEST molecules, and has been the subject of numerous studies with high-level quantum chemical methods. Can we capture the inverted gap, as first measured by Leupin and Wirz?[@leupinLowlyingElectronicallyExcited1980] The calculations reveal that the HOMO and LUMO are well separated with spatial overlap of {{< var azaphenalene_overlap >}} and a correspondingly low exchange interaction of {{< var azaphenalene_2_exchange >}} kcal/mol ([@fig-azaphenalene-orbitals]). The larger azaphenalene has 30 excitations that could possibly contribute to the large $\DeltaE[DSP]{SCF}$ of {{< var azaphenalene_dsp_scf >}} kcal/mol, but the most import by far are those from the doubly degenerate HOMO-1 to the doubly degenerate LUMO+1 ([@fig-azaphenalene-excitations]). In total, $\DeltaEST[DSP]{SCF}=$ {{< var azaphenalene_t1_s1_dsp_scf >}} kcal/mol, which is slightly smaller at the CIS level with $\DeltaEST[DSP]{CIS}=$ {{< var azaphenalene_t1_s1_dsp_cis >}} kcal/mol.

To conclude this section on the model compounds, our PPP-based protocol is able to capture the inverted gap, and also provides qualitative understanding into the physical mechanism of dynamic spin polarization through identification and visualization of the corresponding excitations. For these two compounds, the calculated $\DeltaEST[DSP]{}$ are more negative at the SCF level compared to CIS. Compared to {{< var reference_level >}}, it would seem that CIS is preferable, but to elucidate to which method is better, we now turn to larger datasets. 

![Orbitals energies and frontier orbitals of azaphenalene.]({{< var fig_azaphenalene_orbitals >}}.png){#fig-azaphenalene-orbitals}

![Excitations and their contribution to $\DeltaE[DSP]{SCF}=$ {{< var azaphenalene_dsp_scf >}} kcal/mol for azaphenalene]({{< var fig_azaphenalene_excitations >}}.png){#fig-azaphenalene-excitations}

## Local chemical space of azaphenalenes and azaazulenes

While our method captures the inverted gap of azaphenalene and pentalene, it also needs to capture trends with substitution to work effectively in virtual screening. We therefore calculated 256 substituted azaphenalenes that have previously been studied by some of us.[@polliceOrganicMoleculesInverted2021] The PPP level S~1~ and T~1~ excitation energies are well correlated with those from {{< var reference_level >}} with $R^2$ of {{< var local_azaphenalenes_r2_singlet >}} and {{< var local_azaphenalenes_r2_triplet >}}, respectively ([@fig-local-azaphenalenes]a,b). Unfortunately, the oscillator strengths are not as well reproduced with an $R^2$ of {{< var local_azaphenalenes_r2_f >}}, although the Spearman $\rho$ of {{< var local_azaphenalenes_rho_f >}} indicates the values might be used to rank potential candidates ([@fig-local-azaphenalenes]c). The problems of obtaining accurate oscillator strengths at the PPP level of theory are well known in the literature, and the problem is especially exacerbated with low oscillator strengths as here.[@misurkinElectronicStructureConjugated1974]. Crucially, the $\DeltaE{ST}$ shows good correlations, with $R^2=$ {{< var local_azaphenalenes_r2_cis >}} using $\DeltaEST[DSP]{CIS}$ ([@fig-local-azaphenalenes]f). This $R^2$ value is essentially unchanged from the gap at the CIS level without DSP ({{< var local_azaphenalenes_r2_cis_raw >}}, [@fig-local-azaphenalenes]d) and markedly better than the gap at the SCF level ({{< var local_azaphenalenes_r2_scf >}}, [@fig-local-azaphenalenes]e), showing the importance of going beyond the SCF level to include at least some configuration interaction. The results are of similar or better quality achieved by Pernal and co-workers for different set of azaphenalenes using SCF + DSP with orbitals from DFT.[@drwalRoleSpinPolarization2023] To further analyze the results in terms of a binary classification into normal/inverted, we calculated the true positives (TP), true negatives (TN), false positives (FP) and false negatives (FN), as well as a range of common classification scores (@tbl-local-azaphenalenes). The most important metrics for virtual screening are, in our opinion, the recall and the specificity. The recall measures the fraction of inverted molecules that the protocol captures, and is {{< var local_azaphenalenes_recall_scf >}} at the SCF level and {{< var local_azaphenalenes_recall_cis >}} at the CIS level. The specificity measures the fraction of non-inverted molecules that the protocol identifies, and is {{< var local_azaphenalenes_specificity_scf >}} at the SCF level and {{< var local_azaphenalenes_specificity_cis >}} at the CIS level. This metrics mean that we are able to capture a large proportion of the molecules with inverted gaps, while filtering out most non-inverted molecules. The results for these azaphenalenes clearly indicate that the PPP protocol could be used to prescreen candidates of this compound class for $\DeltaE{ST}$, while further pruning with another method is likely needed for the oscillator strengths.

![Write some text here]({{< var fig_local_azaphenalenes >}}.pdf){#fig-local-azaphenalenes}

```{python}
# | label: tbl-local-azaphenalenes
# | tbl-cap: Astronomical object
# | echo: false
import pandas as pd
from IPython.display import display, Markdown

with open(tab_local_azaphenalenes) as f:
    md = f.read()
display(Markdown(md))
```

While we see success for the azaphenalenes, the situation for the azulenes is unfortunately worse. The PPP level S~1~ and T~1~ excitation energies are only moderately correlated with those from {{< var reference_level >}} with $R^2$ of {{< var local_azulenes_r2_singlet >}} and {{< var local_azulenes_r2_triplet >}}, respectively ([@fig-local-azulenes]a,b). For the oscillator strengths, the situation is rather catastrophic with $R^2$ of {{< var local_azulenes_r2_f >}} implying no correlation whatsoever ([@fig-local-azulenes]c). The situation for the $\DeltaE{ST}$ also worse than for the azaphenalenes, with $R^2=$ {{< var local_azulenes_r2_cis >}} with CIS + DSP, a marked improvement on {{< var local_azulenes_r2_scf >}} with SCF + DSP ([@fig-local-azulenes]e,f). Unfortunately, the negative gaps are not recovered, leading to recalls of {{< var local_azulenes_recall_cis >}} as none of five inverted molecules could be identified ([@tbl-local-azulenes]). It could be speculated that the worse performance for the azulenes comes from the fact that they are non-alternants, for which the approximations are expected to be less applicable. Considering the contrasting performance for the azaphenalenes and azulenes, it seems clear that the PPP screening protocol will inevitably miss some hits belonging to particular compound classes. To investigate the global performance of the model we turned to a more diverse set with 16 different compound classes. 

![Here's some more text]({{< var fig_local_azulenes >}}.pdf){#fig-local-azulenes}

```{python}
# | label: tbl-local-azulenes
# | tbl-cap: Astronomical object
# | echo: false
import pandas as pd
from IPython.display import display, Markdown

with open(tab_local_azulenes) as f:
    md = f.read()
display(Markdown(md))
```

## Screening widely

Here we used a dataset previously generated by some of us using rational design rules, comprising 16 different molecular scaffolds, the details of which will be presented elsewhere. Out of {{< var global_n_total >}} compounds, only {{< var global_n_failed >}} failed, which corresponds to a success rate of {{< var global_percent_success >}}. The total runtime using four cores on the M2 processor was {{< var time_cpu_hours >}} CPU hours. The S~1~ and T~1~ excitation energies are fairly reproduced with ([@fig-global-all]a,b) $R^2$ of {{< var global_all_r2_singlet >}} and {{< var global_all_r2_triplet >}} vs {{< var reference_level >}}, respectively. As seen in [@fig-global-all-gaps]a, the $\DeltaE{ST}$ at the SCF + DSP level shows a moderate $R^2$ of {{< var global_all_r2_scf >}}, which increases significantly to {{< var global_all_r2_cis >}} at the CIS + DSP level ([@fig-global-all-gaps]b). However, due to a systematic overestimation of $\DeltaE{ST}$, the F1 score is still low at {{< var global_all_f1_cis >}} and a poor recall of {{< var global_all_recall_cis >}} ([@tbl-global-all]). We therefore added a linear correction $\DeltaEST[DSP]{CIS,LC}=$ {{< var global_lc_coef >}} $\times\DeltaEST[DSP]{CIS}$ {{< var global_lc_intercept >}}, which increases the F1 score to {{< var global_all_f1_cis_corr >}} and the recall to {{< var global_all_recall_cis_corr >}} ([@fig-global-all-gaps]c). The specificity simultaneously decreases from {{< var global_all_specificity_cis >}} to {{< var global_all_specificity_cis_corr >}}, but overall the linear correction would be preferable for virtual screening where there is a stronger focus on finding rare hits. Applying the linear correction to the azaphenalenes ([@fig-local-corr]a) and ([@fig-local-corr]b) leads to an improvement in the recall of the former from {{< var local_azaphenalenes_recall_cis >}} to {{< var local_azaphenalenes_recall_cis_corr >}} while still none of the inverted azulenes are recovered. The oscillator strengths are unfortunately poorly correlated for the rational design set, with $R^2=$ {{< var global_all_r2_oscillator >}}, although the Spearman rank correlation is more encouraging at {{< var global_all_rho_oscillator >}} ([@fig-global-all]c). Taken together, the results reinforce the conclusions from the case study of the azaphenalenes, that the PPP protocol is suitable for screening $\DeltaE{ST}$ while it struggles for oscillator strengths.

A more detailed breakdown of the correlations into the different scaffolds shows that the highest $R^2$ of {{< var global_scaffolds_r2_max >}} is obtained for {{< var global_scaffolds_r2_max_name >}}, while the lowest is obtained for {{< var global_scaffolds_r2_min_name >}} with {{< var global_scaffolds_r2_min >}}. For recall, the corresponding range is {{< var global_scaffolds_recall_max >}} for {{< var global_scaffolds_recall_max_name >}} to {{< var global_scaffolds_recall_min >}} for {{< var global_scaffolds_recall_min_name >}}. The wide range in $R^2$ and recall further reinforces that the method struggles with some particular compounds classes despite its favorable global performance. Despite these problems, the method is able to capture inverted molecules in {{< var global_scaffolds_n_captured >}} out of the 15 scaffolds where they occur. Even for the azulenes included in this screening set at least some candidates are found, in contrast to the findings above for the azaazulenes. The per-scaffold oscillator strengths are arguably sufficiently good to allow for local screening in some cases ([@fig-global-scaffolds-oscillator]). The per-scaffold S~1~ and T~1~ excitation energies can be found in ([@fig-global-scaffolds-singlet]) and ([@fig-global-scaffolds-triplet]), respectively. Notable failures are for {{< var I >}} with $R^2$ of {{< var global_scaffolds_singlet_r2_I >}} and {{< var global_scaffolds_triplet_r2_I >}}, respectively, and {{< var XII >}} and {{< var XVI >}}, where some negative T~1~ excitation energies indicate restricted-unrestricted instabilities.

![Write some text here]({{< var fig_global_all_gaps >}}.pdf){#fig-global-all-gaps}

```{python}
# | label: tbl-global-all
# | tbl-cap: Astronomical object
# | echo: false
import pandas as pd
from IPython.display import display, Markdown

with open(tab_global_all_gaps) as f:
    md = f.read()
display(Markdown(md))
```

## External validation

To further test the validity of the method, we calculated a series of compounds recently published by Garner _et. al_.[@garnerDoublebondDelocalizationNonalternant2023] The dataset comes in three parts: (1) non-alternants, (2) non-alternants with constrained high-symmetry geometries (we here follow the original terminology and call these "avoided symmetry") and (3) substituted non-alternants (here called "substituted"). Out of the substituted compounds, four could not be calculated as they contain four-coordinate P atoms for which our PPP model lacks parameters. We here opted to use the {{< var reference_level_garner >}}/aug-cc-pVDZ data from the original paper as reference as it is the highest level which has the most complete coverage of the dataset.

Our computed $\DeltaE{ST}$ with the linearly corrected CIS + DSP show fair correlations with the {{< var reference_level_garner >}} values, with $R^2$s of {{< var garner_gaps_r2_non_alternants >}}, {{< var garner_gaps_r2_avoided_symmetry >}} and {{< var garner_gaps_r2_substituted >}}, respectively ([@fig-garner-gaps]). Gratifyingly, the recalls are {{< var garner_gaps_recall_non_alternants >}}, {{< var garner_gaps_recall_avoided_symmetry >}} and {{< var garner_gaps_recall_substituted >}}, respectively, showing that we can recover a large part of the inverted molecules found with the much more expensive {{< var reference_level_garner >}} method ([@tbl-garner-gaps]). Although some of the compounds are also present in the rationally designed set that we used for the linear correction above, we believe that they are not sufficiently many to compromise the use of the Garner data as external validation ([@fig-garner-gaps]). We also indicate in the plots which compounds show instabilities ([@fig-garner-gaps]). There seems to be no clear deterioration in the performance, although also the reference data might exhibit instabilities as there is no mention of any stability analysis in the original manuscript.[@garnerDoublebondDelocalizationNonalternant2023] 

In summary, the external validation shows that the PPP method can recover inverted molecules at a fraction of the cost of more expensive methods such as {{< var reference_level_garner >}}.

![Write some text here]({{< var fig_garner_gaps >}}.pdf){#fig-garner-gaps}

```{python}
# | label: tbl-garner-gaps
# | tbl-cap: Astronomical object
# | echo: false
import pandas as pd
from IPython.display import display, Markdown

with open(tab_garner_gaps) as f:
    md = f.read()
display(Markdown(md))
```

# Conclusions and outlook

To conclude, we have shown that the Pariser-Parr-Pople theory, a simple semi-empirical $\pi$-electron theory with a minimal basis, can be used to screen for molecules with inverted singlet-triplets energy gaps, both locally and globally. Unfortunately, the method does not seem capable of screening for oscillator strengths with the same accuracy, with exceptions for some scaffolds. The chief limitation of the method is that it only includes the $\pi$-electron system and therefore struggles with: (1) functional groups without a clear $\sigma$--$\pi$ separation (found in common functional groups such as sulfonyls) (2) inductive effects and (3) neglect of $n \rightarrow \pi^*$ transitions. Further limitations include (4) lack of solvation model and need for (5) already optimized geometries. We believe that at at least some of these limitations could be mitigated by a reparametrization specifically targeting inverted gaps, while geometries from the fast GFN-xTB method would be suitable. 

Taken together, we foresee that the presented methodology can be used for ultrahigh-throughput virtual screening campaigns and in inverse design algorithms, followed by curation of hits using more accurate quantum-chemical methods. Active learning schemes could also be used with machine learning corrections to the PPP singlet-triplet gaps. The method has great potential to accelerate the discovery of the next generation of OLED materials based on INVEST.

# Acknowledgements

K.J. acknowledges funding through an International Postdoc grant from the Swedish Research Council (No. 2020-00314). A. A.-G. acknowledges support of Natural Resources Canada and the Canada 150 Research Chairs program and CIFAR, as well as the generous support of Anders G. Frøseth. 

# References

::: {#refs}
:::

\newpage
\setcounter{page}{1}
\setcounter{section}{0}
\setcounter{figure}{0}
\setcounter{table}{0}
\renewcommand{\thepage}{S\arabic{page}}
\renewcommand{\thesection}{S\arabic{section}}
\renewcommand{\thetable}{S\arabic{table}}
\renewcommand{\thefigure}{S\arabic{figure}}

# Supporting information

![Singlet and triplet excitation energies as well as oscillator strengths for the rationally designed dataset *vs.* the reference level.]({{< var fig_global_all >}}.pdf){#fig-global-all}

![Singlet-triplet gap split by scaffold for the rationally designed dataset *vs.* the reference level.]({{< var fig_global_scaffolds_gaps >}}.png){#fig-global-scaffolds-gaps}

![Singlet excitation energies split by scaffold for the rationally designed dataset *vs.* the reference level.]({{< var fig_global_scaffolds_singlet >}}.png){#fig-global-scaffolds-singlet}

![Triplet excitation energies split by scaffold for the rationally designed dataset *vs.* the reference level.]({{< var fig_global_scaffolds_triplet >}}.png){#fig-global-scaffolds-triplet}

![Oscillator strengths split by scaffold for the rationally designed dataset *vs.* the reference level.]({{< var fig_global_scaffolds_oscillator >}}.png){#fig-global-scaffolds-oscillator}

![Singlet-triplet gaps with CIS + DSP and linear correction for the (a) azaphenalenes and (b) azaazulenes *vs.* the reference level.]({{< var fig_local_corr >}}.pdf){#fig-local-corr}

```{python}
# | label: tbl-global-scaffolds
# | tbl-cap: Metrics split by scaffold for the rationally designed dataset.
# | echo: false
import pandas as pd
from IPython.display import display, Markdown

with open(tab_global_scaffolds) as f:
    md = f.read()
display(Markdown(md))
```

